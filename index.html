<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Real-Time DEX Arbitrage Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .pulse { animation: pulse 2s infinite; }
    .token-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid #374151;
      background: linear-gradient(135deg, #1f2937, #374151);
      object-fit: cover;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .token-pair {
      position: relative;
      display: inline-flex;
      align-items: center;
    }
    .token-icon-first {
      z-index: 2;
    }
    .token-icon-second {
      margin-left: -12px;
      z-index: 1;
    }
    .profit-badge {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      font-weight: bold;
      padding: 6px 12px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.95rem;
    }
    .profit-badge.low {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    .profit-badge.high {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    }
  </style>
</head>
<body class="bg-gray-900">
  <div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
      
      <!-- Header -->
      <div class="text-center mb-8">
        <div class="flex items-center justify-center gap-3 mb-3">
          <div class="p-3 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl">
            <i class="fas fa-search-dollar text-white text-3xl"></i>
          </div>
          <div>
            <h1 class="text-3xl md:text-4xl font-bold text-white">Real-Time DEX Arbitrage Scanner</h1>
            <p class="text-gray-300 mt-1">Uniswap V3 ↔ Paraswap V5 Arbitrage Opportunities</p>
          </div>
        </div>
        <div class="inline-flex items-center gap-2 bg-slate-800/50 px-4 py-2 rounded-full">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-red-500" id="connectionIndicator"></div>
            <span id="backendStatus" class="text-sm text-gray-300">Checking connection...</span>
          </div>
          <span class="text-gray-500">•</span>
          <span class="text-sm text-gray-400" id="tokenCount">Select network</span>
        </div>
      </div>

      <!-- Network Selector -->
      <div class="mb-6 bg-slate-800/70 backdrop-blur-sm rounded-xl p-5 border border-slate-700 shadow-lg">
        <h3 class="text-lg md:text-xl font-semibold text-white mb-4">
          <i class="fas fa-network-wired mr-2"></i>Select Network
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3" id="networkButtons"></div>
        <p id="networkWarning" class="text-sm text-yellow-400 mt-3 hidden">
          <i class="fas fa-exclamation-triangle mr-1"></i>Stop scanning to switch networks
        </p>
      </div>

      <!-- Stats Dashboard -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6">
        <div class="bg-slate-800/70 backdrop-blur-sm rounded-xl p-4 border border-slate-700 shadow-lg">
          <p class="text-gray-400 text-sm mb-1"><i class="fas fa-globe mr-1"></i>Network</p>
          <p class="text-lg md:text-xl font-bold text-white truncate" id="currentNetwork">Arbitrum</p>
        </div>
        <div class="bg-slate-800/70 backdrop-blur-sm rounded-xl p-4 border border-slate-700 shadow-lg">
          <p class="text-gray-400 text-sm mb-1"><i class="fas fa-bolt mr-1"></i>Live Opportunities</p>
          <p class="text-lg md:text-2xl font-bold text-white" id="totalOpps">0</p>
        </div>
        <div class="bg-slate-800/70 backdrop-blur-sm rounded-xl p-4 border border-slate-700 shadow-lg">
          <p class="text-gray-400 text-sm mb-1"><i class="fas fa-money-bill-wave mr-1"></i>Avg Profit</p>
          <p class="text-lg md:text-2xl font-bold text-green-400" id="avgProfit">$0.00</p>
        </div>
        <div class="bg-slate-800/70 backdrop-blur-sm rounded-xl p-4 border border-slate-700 shadow-lg">
          <p class="text-gray-400 text-sm mb-1"><i class="fas fa-gas-pump mr-1"></i>Est. Gas</p>
          <p class="text-lg md:text-2xl font-bold text-yellow-400" id="gasCost">$0.00</p>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="mb-6 bg-slate-800/70 backdrop-blur-sm rounded-xl p-5 border border-slate-700 shadow-lg">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
          <div class="flex items-center gap-3">
            <div class="relative">
              <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center">
                <i class="fas fa-search text-white"></i>
              </div>
              <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-gray-500 border-2 border-slate-900" id="scanIndicator"></div>
            </div>
            <div class="text-white">
              <span id="scanStatus" class="font-medium">Ready to scan</span>
              <div id="scanTimer" class="text-sm text-gray-400 mt-1 hidden">
                <i class="fas fa-clock mr-1"></i>Next scan in: <span id="countdown" class="font-bold">90</span>s
              </div>
            </div>
          </div>
          <div class="flex gap-3">
            <button id="singleScanButton" class="px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 transition-all shadow-lg">
              <i class="fas fa-search mr-2"></i>Single Scan
            </button>
            <button id="scanButton" class="px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-700 hover:from-green-700 hover:to-emerald-800 transition-all shadow-lg">
              <i class="fas fa-play mr-2"></i>Start Auto-Scan
            </button>
          </div>
        </div>
        <div class="mt-4 text-sm text-gray-400">
          <p><i class="fas fa-info-circle mr-1"></i>Scanning top token pairs on the selected network. Each scan takes 30-60 seconds.</p>
        </div>
      </div>

      <!-- Status Message -->
      <div id="statusMessage" class="mb-6 hidden rounded-xl p-4 border">
        <div class="flex items-center">
          <i id="statusIcon" class="fas fa-info-circle mr-3 text-lg"></i>
          <p id="statusText" class="text-white"></p>
        </div>
      </div>

      <!-- Opportunities Table -->
      <div class="bg-slate-800/70 backdrop-blur-sm rounded-xl p-5 border border-slate-700 shadow-lg">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-5 gap-3">
          <div>
            <h3 class="text-lg md:text-xl font-semibold text-white">
              <i class="fas fa-chart-line mr-2"></i>Live Arbitrage Opportunities
            </h3>
            <p class="text-sm text-gray-400 mt-1">Sorted by highest profit. Minimum profit: $5.00</p>
          </div>
          <div class="flex items-center gap-3">
            <div class="text-sm text-gray-400 bg-slate-800/50 px-3 py-2 rounded-lg" id="lastUpdate">
              <i class="fas fa-history mr-2"></i>Last scan: Never
            </div>
            <button id="clearOpportunities" class="text-sm text-gray-400 hover:text-gray-300 bg-slate-800/50 hover:bg-slate-700/50 px-3 py-2 rounded-lg transition-colors">
              <i class="fas fa-trash-alt mr-2"></i>Clear All
            </button>
          </div>
        </div>
        
        <div class="overflow-x-auto rounded-xl border border-slate-700">
          <table class="min-w-full divide-y divide-slate-700">
            <thead class="bg-slate-800">
              <tr>
                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Token Pair</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Arbitrage Path</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Buy Price</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Sell Price</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Profit</th>
                <th class="px-6 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Details</th>
              </tr>
            </thead>
            <tbody id="opportunitiesList" class="bg-slate-800/50 divide-y divide-slate-700">
              <tr>
                <td colspan="6" class="px-6 py-16 text-center text-gray-400">
                  <div class="flex flex-col items-center justify-center">
                    <div class="w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center mb-4">
                      <i class="fas fa-search text-2xl text-gray-600"></i>
                    </div>
                    <p class="text-lg font-medium text-gray-300 mb-2">No opportunities found yet</p>
                    <p class="text-sm text-gray-500">Start scanning to discover arbitrage opportunities</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
          <div class="bg-slate-800/50 p-3 rounded-lg">
            <p class="text-gray-400 mb-1"><i class="fas fa-lightbulb mr-2"></i>How it works</p>
            <p class="text-gray-300">Scans price differences between Uniswap V3 and Paraswap V5</p>
          </div>
          <div class="bg-slate-800/50 p-3 rounded-lg">
            <p class="text-gray-400 mb-1"><i class="fas fa-gas-pump mr-2"></i>Gas Cost</p>
            <p class="text-gray-300">Net profit includes estimated gas costs for execution</p>
          </div>
          <div class="bg-slate-800/50 p-3 rounded-lg">
            <p class="text-gray-400 mb-1"><i class="fas fa-shield-alt mr-2"></i>Safety</p>
            <p class="text-gray-300">Filters unrealistic profits (>50% price difference)</p>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="mt-8 pt-6 border-t border-slate-800 text-center text-gray-500 text-sm">
        <p>Real-Time DEX Arbitrage Scanner • Scanning Uniswap V3 vs Paraswap V5</p>
        <p class="mt-1" id="backendUrlDisplay">Backend URL: <span id="currentBackendUrl" class="text-blue-400">Detecting...</span></p>
      </div>

    </div>
  </div>

  <script>
    // Configuration
    const BACKEND_URL = window.location.origin;
    
    // Application state
    let selectedNetwork = 'arbitrum';
    let isScanning = false;
    let scanInterval = null;
    let countdownInterval = null;
    let opportunities = [];
    let stats = { 
      total: 0, 
      scans: 0, 
      avgProfit: 0,
      gasCost: 0,
      lastScanTime: null
    };

    // Network configuration
    const NETWORKS = {
      arbitrum: { 
        name: 'Arbitrum', 
        color: 'bg-cyan-600', 
        borderColor: 'border-cyan-500',
        chainId: 42161,
        icon: 'fas fa-bolt',
        tokenCount: '14 tokens'
      },
      polygon: { 
        name: 'Polygon', 
        color: 'bg-purple-600', 
        borderColor: 'border-purple-500',
        chainId: 137,
        icon: 'fas fa-gem',
        tokenCount: '11 tokens'
      },
      optimism: { 
        name: 'Optimism', 
        color: 'bg-red-600', 
        borderColor: 'border-red-500',
        chainId: 10,
        icon: 'fas fa-rocket',
        tokenCount: '10 tokens'
      }
    };

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('currentBackendUrl').textContent = BACKEND_URL;
      
      initNetworkButtons();
      checkBackendConnection();
      updateTokenCount();
      
      // Event listeners
      document.getElementById('scanButton').onclick = toggleAutoScan;
      document.getElementById('singleScanButton').onclick = performSingleScan;
      document.getElementById('clearOpportunities').onclick = clearOpportunities;
      
      selectNetwork(selectedNetwork);
    });

    // Update token count display
    function updateTokenCount() {
      const network = NETWORKS[selectedNetwork];
      document.getElementById('tokenCount').textContent = `Scanning ${network.tokenCount}`;
    }

    // Check backend connection
    async function checkBackendConnection() {
      const statusEl = document.getElementById('backendStatus');
      const indicatorEl = document.getElementById('connectionIndicator');
      
      try {
        const response = await fetch(`${BACKEND_URL}/health`, { 
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
          const data = await response.json();
          
          statusEl.textContent = 'Backend connected';
          indicatorEl.className = 'w-3 h-3 rounded-full bg-green-500';
          document.getElementById('backendStatus').classList.remove('text-red-400');
          document.getElementById('backendStatus').classList.add('text-green-400');
          
          document.getElementById('currentBackendUrl').textContent = BACKEND_URL;
          document.getElementById('currentBackendUrl').classList.remove('text-red-400');
          document.getElementById('currentBackendUrl').classList.add('text-green-400');
          
          return true;
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        statusEl.textContent = 'Backend disconnected';
        indicatorEl.className = 'w-3 h-3 rounded-full bg-red-500';
        document.getElementById('backendStatus').classList.remove('text-green-400');
        document.getElementById('backendStatus').classList.add('text-red-400');
        
        document.getElementById('currentBackendUrl').textContent = `${BACKEND_URL} (Error: ${error.message})`;
        document.getElementById('currentBackendUrl').classList.remove('text-green-400');
        document.getElementById('currentBackendUrl').classList.add('text-red-400');
        
        setStatus('Cannot connect to backend server. The scanner may be starting up...', 'red');
        return false;
      }
    }

    // Initialize network selection buttons
    function initNetworkButtons() {
      const container = document.getElementById('networkButtons');
      container.innerHTML = '';
      
      Object.entries(NETWORKS).forEach(([key, network]) => {
        const button = document.createElement('button');
        button.id = `net-${key}`;
        button.className = `p-4 rounded-xl border-2 transition-all flex flex-col items-center ${key === selectedNetwork ? 
          `${network.color} ${network.borderColor} text-white shadow-lg` : 
          'bg-slate-700 border-slate-600 text-gray-300 hover:bg-slate-600 hover:border-slate-500'}`;
        button.innerHTML = `
          <div class="flex items-center justify-center gap-2 mb-2">
            <i class="${network.icon} text-lg"></i>
            <div class="font-semibold text-center">${network.name}</div>
          </div>
          <div class="text-xs mt-1">${network.tokenCount}</div>`;
        button.onclick = () => selectNetwork(key);
        container.appendChild(button);
      });
    }

    // Select network
    function selectNetwork(network) {
      if (isScanning) {
        document.getElementById('networkWarning').classList.remove('hidden');
        setTimeout(() => {
          document.getElementById('networkWarning').classList.add('hidden');
        }, 3000);
        return;
      }
      
      selectedNetwork = network;
      document.getElementById('currentNetwork').textContent = NETWORKS[network].name;
      opportunities = [];
      stats = { total: 0, scans: 0, avgProfit: 0, gasCost: 0, lastScanTime: null };
      updateStats();
      updateTokenCount();
      renderOpportunities();
      initNetworkButtons();
      setStatus(`Switched to ${NETWORKS[network].name} network`, 'blue');
    }

    // Get token icon URL
    function getTokenIconUrl(symbol) {
      const cleanSymbol = symbol.replace('W', '').toLowerCase();
      return `https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/color/${cleanSymbol}.png`;
    }

    // Create token pair display with icons
    function createTokenPairDisplay(tokenIn, tokenOut, pairText) {
      // Use the actual symbol from backend
      let tokenInSymbol = tokenIn?.symbol || (pairText ? pairText.split('/')[0] : 'Token');
      let tokenOutSymbol = tokenOut?.symbol || (pairText ? pairText.split('/')[1] : 'Token');
      
      return `
        <div class="flex items-center gap-3">
          <div class="token-pair">
            <img src="${getTokenIconUrl(tokenInSymbol)}" 
                 class="token-icon token-icon-first"
                 alt="${tokenInSymbol}"
                 onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/color/generic.png'">
            <img src="${getTokenIconUrl(tokenOutSymbol)}" 
                 class="token-icon token-icon-second"
                 alt="${tokenOutSymbol}"
                 onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/color/generic.png'">
          </div>
          <div>
            <div class="font-bold text-white">${tokenInSymbol}/${tokenOutSymbol}</div>
            <div class="text-xs text-gray-400 flex items-center gap-1">
              <i class="fas fa-exchange-alt"></i>
              <span>Swap pair</span>
            </div>
          </div>
        </div>
      `;
    }

    // Create profit badge with appropriate color
    function createProfitBadge(profit) {
      const profitNum = parseFloat(profit) || 0;
      let badgeClass = 'profit-badge';
      
      if (profitNum > 50) {
        badgeClass += ' high';
      } else if (profitNum > 20) {
        // Default class (medium profit)
      } else {
        badgeClass += ' low';
      }
      
      return `
        <div class="${badgeClass}">
          <i class="fas fa-arrow-up"></i>
          $${profitNum.toFixed(2)}
        </div>
      `;
    }

    // Perform a single scan
    async function performSingleScan() {
      if (isScanning) return;
      
      const connected = await checkBackendConnection();
      if (!connected) {
        setStatus('Cannot connect to backend server. Please wait for it to start or check the URL.', 'red');
        return;
      }
      
      setStatus(`Scanning ${NETWORKS[selectedNetwork].name} for opportunities...`, 'blue');
      document.getElementById('scanStatus').textContent = 'Scanning...';
      document.getElementById('scanIndicator').classList.add('pulse');
      document.getElementById('singleScanButton').disabled = true;
      
      try {
        const scanUrl = `${BACKEND_URL}/api/scan/${selectedNetwork}`;
        
        const response = await fetch(scanUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          }
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 100)}`);
        }
        
        const data = await response.json();
        
        stats.scans++;
        stats.gasCost = data.gasCost || 0;
        
        if (data.success) {
          stats.lastScanTime = new Date();
          document.getElementById('lastUpdate').innerHTML = `
            <i class="fas fa-history mr-2"></i>Last scan: ${formatTime(stats.lastScanTime)}
          `;
          
          if (data.opportunities && data.opportunities.length > 0) {
            const newOpps = data.opportunities.map(opp => ({
              ...opp,
              id: opp.id || Date.now() + Math.random().toString(36).substr(2, 9)
            }));
            
            opportunities = [...newOpps, ...opportunities]
              .slice(0, 30)
              .sort((a, b) => {
                const profitA = parseFloat(a.profitUSD || a.netProfitUSD || 0);
                const profitB = parseFloat(b.profitUSD || b.netProfitUSD || 0);
                return profitB - profitA;
              });
            
            stats.total = opportunities.length;
            stats.avgProfit = opportunities.length > 0 ? 
              (opportunities.reduce((sum, opp) => sum + parseFloat(opp.profitUSD || opp.netProfitUSD || 0), 0) / opportunities.length).toFixed(2) : 
              '0.00';
            
            setStatus(`Found ${newOpps.length} opportunities on ${NETWORKS[selectedNetwork].name}`, 'green');
          } else {
            opportunities = [];
            setStatus('No arbitrage opportunities found at this time', 'yellow');
          }
          
          updateStats();
          renderOpportunities();
        } else {
          setStatus(data.error || 'Scan failed', 'red');
        }
      } catch (error) {
        console.error('Scan error:', error);
        setStatus(`Scan failed: ${error.message}`, 'red');
      } finally {
        document.getElementById('scanStatus').textContent = 'Ready to scan';
        document.getElementById('scanIndicator').classList.remove('pulse');
        document.getElementById('singleScanButton').disabled = false;
      }
    }

    // Toggle auto-scan
    function toggleAutoScan() {
      const scanButton = document.getElementById('scanButton');
      
      if (isScanning) {
        clearInterval(scanInterval);
        clearInterval(countdownInterval);
        isScanning = false;
        scanButton.innerHTML = '<i class="fas fa-play mr-2"></i>Start Auto-Scan';
        scanButton.className = 'px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-700 hover:from-green-700 hover:to-emerald-800 transition-all shadow-lg';
        document.getElementById('scanStatus').textContent = 'Stopped';
        document.getElementById('scanTimer').classList.add('hidden');
        setStatus('Auto-scan stopped', 'yellow');
      } else {
        isScanning = true;
        scanButton.innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Auto-Scan';
        scanButton.className = 'px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-red-600 to-rose-700 hover:from-red-700 hover:to-rose-800 transition-all shadow-lg';
        document.getElementById('scanStatus').textContent = 'Auto-scanning...';
        document.getElementById('scanTimer').classList.remove('hidden');
        
        performSingleScan();
        scanInterval = setInterval(performSingleScan, 90000);
        startCountdown(90);
        
        setStatus('Auto-scan started (every 90 seconds)', 'green');
      }
    }

    // Start countdown timer
    function startCountdown(seconds) {
      const timerEl = document.getElementById('scanTimer');
      const countdownEl = document.getElementById('countdown');
      
      timerEl.classList.remove('hidden');
      countdownEl.textContent = seconds;
      
      clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        seconds--;
        countdownEl.textContent = seconds;
        
        if (seconds <= 0) {
          seconds = 90;
          countdownEl.textContent = seconds;
        }
      }, 1000);
    }

    // Update statistics display
    function updateStats() {
      document.getElementById('totalOpps').textContent = stats.total;
      document.getElementById('avgProfit').textContent = `$${stats.avgProfit}`;
      document.getElementById('gasCost').textContent = `$${stats.gasCost.toFixed(2)}`;
    }

    // Set status message
    function setStatus(text, color = 'blue') {
      const statusMap = {
        'blue': { bg: 'bg-blue-900/30', border: 'border-blue-700', icon: 'fa-info-circle' },
        'green': { bg: 'bg-green-900/30', border: 'border-green-700', icon: 'fa-check-circle' },
        'red': { bg: 'bg-red-900/30', border: 'border-red-700', icon: 'fa-exclamation-circle' },
        'yellow': { bg: 'bg-yellow-900/30', border: 'border-yellow-700', icon: 'fa-exclamation-triangle' }
      };
      
      const config = statusMap[color] || statusMap.blue;
      const messageEl = document.getElementById('statusMessage');
      const iconEl = document.getElementById('statusIcon');
      const textEl = document.getElementById('statusText');
      
      messageEl.className = `mb-6 rounded-xl p-4 border ${config.bg} ${config.border}`;
      iconEl.className = `fas ${config.icon} mr-3 text-lg`;
      iconEl.classList.add(color === 'blue' ? 'text-blue-400' : 
                          color === 'green' ? 'text-green-400' : 
                          color === 'red' ? 'text-red-400' : 'text-yellow-400');
      textEl.textContent = text;
      messageEl.classList.remove('hidden');
      
      if (color !== 'red') {
        setTimeout(() => {
          messageEl.classList.add('hidden');
        }, 5000);
      }
    }

    // Render opportunities table
    function renderOpportunities() {
      const container = document.getElementById('opportunitiesList');
      
      if (!opportunities || opportunities.length === 0) {
        container.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-16 text-center text-gray-400">
              <div class="flex flex-col items-center justify-center">
                <div class="w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center mb-4">
                  <i class="fas fa-search text-2xl text-gray-600"></i>
                </div>
                <p class="text-lg font-medium text-gray-300 mb-2">No opportunities found yet</p>
                <p class="text-sm text-gray-500">Start scanning to discover arbitrage opportunities</p>
              </div>
            </td>
          </tr>`;
        return;
      }
      
      container.innerHTML = opportunities.map(opp => {
        const buyPrice = opp.priceInfo?.buyPrice || 'N/A';
        const sellPrice = opp.priceInfo?.sellPrice || 'N/A';
        const buyDex = opp.priceInfo?.buyDex || opp.dexBuy || 'N/A';
        const sellDex = opp.priceInfo?.sellDex || opp.dexSell || 'N/A';
        
        return `
        <tr class="hover:bg-slate-700/30 transition-colors">
          <td class="px-6 py-4">
            ${createTokenPairDisplay(opp.tokenIn, opp.tokenOut, opp.pair)}
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col">
              <div class="text-sm text-gray-300 font-medium mb-1">${opp.direction || `${buyDex} → ${sellDex}`}</div>
              <div class="text-xs text-gray-500">
                <i class="fas fa-arrow-right mr-1"></i>${buyDex} → ${sellDex}
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col">
              <div class="text-white font-bold">${buyPrice}</div>
              <div class="text-xs text-gray-400 mt-1">
                <i class="fas fa-store mr-1"></i>${buyDex}
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col">
              <div class="text-white font-bold">${sellPrice}</div>
              <div class="text-xs text-gray-400 mt-1">
                <i class="fas fa-store mr-1"></i>${sellDex}
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            ${createProfitBadge(opp.profitUSD || opp.netProfitUSD)}
            <div class="text-xs text-gray-400 mt-2 flex flex-col">
              <span><i class="fas fa-gas-pump mr-1"></i>Gas: $${opp.gasCostUSD || '0.00'}</span>
              <span class="mt-1"><i class="fas fa-dollar-sign mr-1"></i>Size: $${(opp.tradeSizeUSD || 1000).toLocaleString()}</span>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-col gap-2">
              <button onclick="showOpportunityDetails('${opp.id}')" 
                      class="px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg font-medium transition-all text-sm">
                <i class="fas fa-info-circle mr-2"></i>View Details
              </button>
              <button onclick="copyTradeInfo('${opp.id}')" 
                      class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-gray-300 rounded-lg font-medium transition-all text-sm">
                <i class="fas fa-copy mr-2"></i>Copy Info
              </button>
            </div>
          </td>
        </tr>
        `;
      }).join('');
    }

    // Show opportunity details
    window.showOpportunityDetails = function(oppId) {
      const opportunity = opportunities.find(opp => opp.id === oppId);
      if (!opportunity) return;
      
      const details = `
Arbitrage Opportunity Details:
─────────────────────────────
Network: ${NETWORKS[opportunity.network]?.name || opportunity.network}
Token Pair: ${opportunity.tokenIn?.symbol}/${opportunity.tokenOut?.symbol}
Direction: ${opportunity.direction}
─────────────────────────────
Trade Size: $${opportunity.tradeSizeUSD || 1000}
Buy Price: ${opportunity.priceInfo?.buyPrice || 'N/A'} (${opportunity.priceInfo?.buyDex || 'N/A'})
Sell Price: ${opportunity.priceInfo?.sellPrice || 'N/A'} (${opportunity.priceInfo?.sellDex || 'N/A'})
─────────────────────────────
Gross Profit: $${opportunity.profitUSD || opportunity.netProfitUSD}
Gas Cost: $${opportunity.gasCostUSD || '0.00'}
Net Profit: $${opportunity.netProfitUSD || opportunity.profitUSD}
─────────────────────────────
Price Difference: ${opportunity.details?.priceDifference || 'N/A'}
Uniswap Price: ${opportunity.details?.uniswapPrice || 'N/A'} ${opportunity.tokenOut?.symbol}
Paraswap Price: ${opportunity.details?.paraswapPrice || 'N/A'} ${opportunity.tokenOut?.symbol}
─────────────────────────────
Timestamp: ${new Date(opportunity.timestamp).toLocaleString()}
      `;
      
      alert(details);
    };

    // Copy trade info
    window.copyTradeInfo = function(oppId) {
      const opportunity = opportunities.find(opp => opp.id === oppId);
      if (!opportunity) return;
      
      const text = `Arbitrage: ${opportunity.tokenIn?.symbol}/${opportunity.tokenOut?.symbol} - Profit: $${opportunity.profitUSD} - ${opportunity.direction} - ${NETWORKS[opportunity.network]?.name}`;
      
      navigator.clipboard.writeText(text)
        .then(() => {
          setStatus('Trade info copied to clipboard!', 'green');
        })
        .catch(() => {
          setStatus('Failed to copy info', 'red');
        });
    };

    // Clear all opportunities
    function clearOpportunities() {
      opportunities = [];
      stats.total = 0;
      stats.avgProfit = 0;
      updateStats();
      renderOpportunities();
      setStatus('All opportunities cleared', 'blue');
    }

    // Helper function to format time
    function formatTime(date) {
      if (!date) return 'Never';
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }
  </script>
</body>
</html>
